# 计算机网络概述 

## 0.计算机网络结构

计算机网络包括：网络边缘，接入网路，网络核心

* 网络边缘：主机网络应用，运行各种网络应用程序(web,email,BS/CS架构应用，FTP，P2P)
* 接入网络：物理介质，有线或者无线通信链路，将网络边缘介入网络核心，主要有：住宅接入网络，机构接入网络（学校企业），移动接入网络
* 网络核心：互联的路由器或分组转发设备，关键功能是：**路由+转发**


![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170209125531.png)

## 1. 网络核心——数据交换

数据交换类型：

* 电路交换 
* 报文交换
* 分组交换

### 电路交换

最典型的电路交换网络：电话网络

电路交换的三个阶段：1.建立连接（呼叫/电路建立） 2.通信 3.释放连接，拆除电路

这个过程中资源是独占的，可以通过**多路复用**技术实现共享中继线

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170209131925.png)

**多路复用：**链路网络资源划分为“资源片”

* 将资源片分配给各路呼叫
* 每路呼叫独占分配到的资源片进行通信
* 资源片可能闲置（idle）

典型多路复用方法：

* 频分多路复用——FDM frequency  有线电视网络就是频分
* 时分多路复用——TDM time  和操作系统的时间片差不多
* 波分多路复用——WDM wavelength  实际就是光的频分复用，波长和频率
* 码分多路复用——CDM code 广泛应用于无线链路共享（蜂窝，卫星通信），即不划分时间，也不换分频率，划分的是**码**

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170209132742.png)

其中，码分多路复用比较特殊，各个用户使用相同的频率载波，利用各自独特的码片序列`chipping sequence`编码数据，这个码片序列唯一，1用+1表示，0用-1表示。

编码信号=原始数据 * 码片序列

* 发送bit 1，就是发送自己的m bit码片序列
* 发送bit 0，就是发送自己m bit码片序列的反码

> 不同用户之间的码片序列相互正交：不同码片序列点乘为0，自己点乘自己为模M

$$
\frac{1}{m}S_i \ast S_j = \left\{\begin{array}{ll}
		1   &\mbox{i=j}\\
		0   &\mbox{i != j}
	\end{array}
	\right.
$$

因为是码分，所以某个时间时，信道中传输的是所有用户数据序列的叠加后的数据，如下图发送端，用户一二时隙0的序列叠加后再信道中的数据就是`20202-200`

接收端解码：码片序列与编码信号的内积，如果你要接受用户1的数据，则用用户1的码片序列点乘叠加向量，因为不同用户码片序列正交，可以消除其他用户数据干扰，还原用户1发送的数据
$$
\frac{1}{m}S_i \ast P = \left\{\begin{array}{ll}
		1   &\mbox{接收数据1}\\
		-1   &\mbox{接收数据0}\\
		0   &\mbox{无数据}\\
	\end{array}
	\right.
$$
其中$S_i$是解码对象的码片序列，P是叠加向量

![](http://ogzrgstml.bkt.clouddn.com/CDM%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81.png)

### 报文与分组交换

都是采用存储转发交换方式

分组：报文分拆出来的一系列相对较小的数据包，需要报文的拆分与重组

统计多路复用：按需共享链路

分组交换的报文交付时间：T = M/R + nL/R

报文：M bits   链路带宽：R bps   分组长度：L bits   跳步数：h    路由器数：n ;

![mark](http://ogzrgstml.bkt.clouddn.com/blog/20170223/190950416.png)

**为什么Internet不使用电话网络的电路交换呢？**

ANS：因为电路交换每个用户会独占一个链路的频段，而分组交换是统计多路复用，按需共享链路，可以允许更多用户同时使用网络

分组交换的特点：

* 适用于突发数据传输网络：资源充分共享，简单无需呼叫建立
* 可能产生拥塞：分组延迟和丢失

**练习题：**

（14分）如图所示网络。A在t=0时刻开始向C发送一个2Mbits的文件；B在t=0.1+e秒（e为无限趋近于0的小正实数）向D发送一个1Mbits的文件。忽略传播延迟和结点处理延迟。

![mark](http://ogzrgstml.bkt.clouddn.com/blog/20170223/191057045.png)

请回答下列问题：

1) 如果图中网络采用存储-转发方式的报文交换，则A将2Mbits的文件交付给C需要多长时间？B将1Mbits的文件交付给D需要多长时间？

2) 如果图中网络采用存储-转发方式的分组交换，分组长度为等长的1kbits，且忽略分组头开销以及报文的拆装开销，则A将2Mbits的文件交付给C需要大约多长时间？B将1Mbits的文件交付给D需要大约多长时间？

3) 报文交换与分组交换相比，哪种交换方式更公平？（即传输数据量小用时少，传输数据量大用时长）

**Answer:**

1) 由于A先发报文所以，A的报文在路由器的队列中排在B的报文前面，所以A交付2Mbits报文需要时间为：2/10+2/20+2/10=0.5s=500ms；

B将1Mbits的文件交付给D需要时间为：1/10+2/20(排队时间)+1/20+1/10=0.35s=350ms。

2) 从t=0时刻到t=0.1s，A发送了1000个分组，用时：1000×1000/10000000=0.1s，

从t=0.1s时刻起与B共享连接路由器的链路，平均各共享到带宽10Mbps，A大约再用时：1/10+2×1000/10000000=0.1002s交付剩余的1000个分组，故A向C交付2Mbits文件大约需要(0.1+0.1002)s≈0.2s；

B向D交付1Mbits文件需要时间大约为：1/10+2×1000/10000000=0.1002s≈0.1s。

3) 分组交换比报文交换更公平。

##  2 计算机网络性能

速率：单位时间传输信息量，最重要的一个性能指标，一般是指额定速率，理想速率

带宽：通信领域是指信号最高和最低的频率之差，单位是赫兹（Hz），网络中的带宽通常是数字信道所能传送的最高数据率，单位：bps

延迟：

* 结点处理延迟：差错检测，确定输出链路，通常<msec
* 排队延迟：取决于当前路由器的拥塞程度，
* 传输延迟：传输开始——传输结束花费的时间，L——分组长度，R——链路带宽，延迟时间=L/R
* 传播延迟：数据在物理介质上的传播时间，d——物理链路长度，s——信号传播速度（铜缆中传播速度是2*10^8m/s）

传输延迟和传播延迟本质不同，传输延迟是发出去的耗时，传输延迟是发出去了，然后从出发点到终点的延迟

![![img](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170210163900.png)](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170210163900.png)浏览器（主机）查询本地域名服务器1个RTTd，本地域名服务器查询根域名服务器1个RTTd，根域名服务器查询cn域名服务器1个RTTd，cn域名服务器查询com.cn域名服务器1个RTTd，com.cn域名服务器查询kicker.com.cn域名服务器1个RTTd，共5个RTTd。这是递归解析过程，若是迭代解析过程，所用时间也是5个RTTd。

时延带宽积 = 传播时延 * 带宽 = d * R(bits)，时间单位与bit的乘积，又称为以比特为单位的链路长度

丢包率

吞吐量/率：表示在发送端与接收端之间传送数据速率

## 3. 计算机网络体系结构

网络体系结构采用分层结构，分层网络体系结构基本概念：

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170210214010.png)

### OSI参考模型

一共分为七个层次：

* 应用层
* 表示层
* 会话层
* 传输层
* 网络层
* 数据链路层
* 物理层

通信过程：

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170210215659.png)

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170210220124.png)

每一层对数据进行封装，加上头部信息：

* 增加控制信息：构造协议数据单元（PDU）
* 控制信息主要包括：地址（标识发送接收端），差错检测编码，协议控制（附加信息如优先级，服务质量和安全控制）

**物理层**

实现功能：在具体的物理介质上实现bit数据的传输

* 接口特性：机械特性、电气特性、功能特性、规程特性
* 比特编码：如何表示01
* 数据率：
* 比特同步：解决时钟同步问题
* 传输模式：单工、半双工（交替进行，不能同时，例如对讲机）、全双工

**数据链路层**

实现功能：谁接收？一个bit出现错误如何纠正？对数据进行封装

* 负责结点到结点数据传输
* 组帧（Framing）
* 物理寻址：在帧头中增加发送端/接收端的物理地址标识数据 ，发给谁？谁接受？

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170210222448.png)

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170210222532.png)

* 流量控制：匹配发送接受双方的速度，避免数据被淹没而丢失
* 差错控制：检测并重传损坏或丢失帧，避免重复帧
* 访问接入控制：决定在某个时刻哪个设备拥有链路（物理介质）控制使用权

**网络层**

主要功能：是数据可以跨越多个链路，跨越多个不同网络的数据传输

* 负责源主机到目的主机数据分组交付，因为可能穿越多个网络
* 逻辑寻址：全局唯一逻辑地址，确保数据分组被送达目的主机，注意：物理链路层的寻址只是链路上的物理寻址，好比一个机房的电脑号码，而网络层就好比邮政部门，如IP地址
* 路由：路径选择，选择那条路去从这个路由转发到下一个路由
* 分组转发

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170210223750.png)

图中红色字母就是网络层的寻址，类比IP地址，绿色地址就是数据链路层的地址，整个传输过程中，链路层的寻址是不断被覆盖改变的，而网络层的地址是全局并且唯一的

**传输层**

主要功能：负责端到端（进程间）完整报文传输

* 分段与重组：在源会将上一层会话层的数据分段，然后在端会将这些端重组
* SAP寻址：确保将完整报文提交给正确的进程，如端口号
* 连接控制：端到端连接的建立，维护和拆除，逻辑上的连接
* 流量控制：端到端的流量控制
* 差错控制：这个层可以加入差错编码，差错纠正机制

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170216211846.png)

图中DHDT是数据链路层信息，SD是网络层信息（ip路由），xy是传输层信息（端口）

**会话层**

* 对话控制：建立维护
* 对话同步：在数据流中插入同步控制点，一旦我的数据在某个同步点附近中断出意外了，下次恢复只需恢复到最近的一个控制点
* 最“薄”的一层：功能最少的一层，在实际网络中，这一层是不单独存在的

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170216212812.png)

syn就表示那个同步控制点

**表示层**

主要功能：处理两个系统间（端到端）交换信息的语法和语义问题

* 数据表示转化：在发送端，表示层把数据转换成一个和系统无关的主机独立编码，然后到了目的主机，表示层再把这种独立的编码转换为本主机相关的编码
* 加密/解密数据
* 压缩/解压缩数据

在实际的Internet网络中，这一层也不是独立存在的，实际上是在应用层实现

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170216213409.png)

**应用层**

功能最丰富的一层

* 支持用户通过用户代码（如浏览器）或网络接口使用网络服务
* 典型应用层服务：FTP，HTTP，SMTP

### TCP/IP 参考模型

OSI模型是先有了理论，然后去直到网络开发，而TCP/IP模型是先有了各种应用协议，然后再去整理总结出的模型

TCP/IP模型一共只有四层：网络接口层，网际层，运输层，应用层

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170216214002.png)

把网络接口层展开，就是5层参考模型：物理层，数据链路层，网络层，传输层，应用层，这个模型综合了OSI和TCP/IP的优点：

* 应用层（报文）：支持各种网络应用，FTP，HTTP，SMTP
* 传输层（数据段）：进程-进程的数据和传输，TCP，UDP
* 网络层（数据报Datagram）：源主机到目的主机的数据分组路由与转发，IP协议与路由协议
* 链路层（数据帧frame）：相邻网络元素（主机、交换机、路由器等）的数据传输，以太网和802.11（WIFI），PPP
* 物理层（bit）：比特传输

![](http://ogzrgstml.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170216215210.png)

